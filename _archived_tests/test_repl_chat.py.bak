#!/usr/bin/env python3
"""Test the REPL with ChatApplication integration."""

import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent))

from opencli.core.management import ConfigManager, SessionManager
from opencli.repl.repl_chat import create_repl_chat


def main():
    """Test REPL with chat interface."""
    print("Starting REPL with ChatApplication...")
    print("This will show a split-screen interface:")
    print("  - Conversation history on top")
    print("  - Status bar in middle")
    print("  - Input box at bottom")
    print("  - Press Ctrl+C to exit")
    print()

    # Create config and session managers
    config_manager = ConfigManager()
    config = config_manager.get_config()

    # Initialize session
    session_dir = Path(config.session_dir).expanduser()
    session_manager = SessionManager(session_dir)
    session_manager.create_session(working_directory=str(Path.cwd()))

    # Create chat REPL
    chat_repl = create_repl_chat(config_manager, session_manager)

    # Run the application
    chat_repl.run()


if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        print(f"\nError: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)
